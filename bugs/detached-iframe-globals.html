<body>
    <script>
    const iframe = document.createElement('iframe');
    document.body.appendChild(iframe);
    const { contentWindow: { eval: iframeEval } } = iframe;
    iframeEval('window');
    iframeEval(`
        // detached iframe has issues with global console, using the outer one
        window.log = top.console.log;
        window.foo = 1;
    `);
    iframe.remove();
    iframeEval(`
        window.foo = 2;
        if (window.foo !== 2) {
            log('fails!');
        } else {
            log('works!');
        }
    `);
    </script>
</body>